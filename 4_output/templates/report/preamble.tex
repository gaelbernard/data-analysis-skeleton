% =============================================================================
%  Report Preamble -- reusable LaTeX setup for data analysis reports
%  Reference via include-in-header in the Quarto YAML.
% =============================================================================

% --- Modern sans-serif font ------------------------------------------------
% Helvetica Neue via fontspec -- crisp OpenType rendering.
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}
\setsansfont[Scale=0.95]{Helvetica Neue}
\renewcommand{\familydefault}{\sfdefault}

% --- Micro-typography -------------------------------------------------------
% Subtle character spacing & protrusion -- dramatically cleaner text.
\usepackage{microtype}

% --- Spacing -----------------------------------------------------------------
\usepackage{setspace}
\setstretch{1.12}

% Modern paragraph style: no indent, space between paragraphs.
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5em plus 0.1em minus 0.05em}

% --- Colors ------------------------------------------------------------------
\usepackage{xcolor}
\definecolor{linkblue}{HTML}{1A5276}     % Dark blue for links
\definecolor{accent}{HTML}{2B2B2B}       % Near-black for accents
\definecolor{boxbg}{HTML}{F6F8FA}        % Light background for boxes
\definecolor{boxtitle}{HTML}{333333}     % Dark gray for box title text
\definecolor{accentbar}{HTML}{444444}    % Left accent bar
\definecolor{lightgray}{HTML}{E0E0E0}   % Rules, dividers
\definecolor{midgray}{HTML}{999999}      % Header/footer text
\definecolor{subtlegray}{HTML}{666666}   % Subtitle text

% Disclaimer colors
\definecolor{disclaimerbg}{HTML}{FFF8E1}     % Warm cream background
\definecolor{disclaimerbar}{HTML}{F0A830}    % Amber accent bar
\definecolor{disclaimertitle}{HTML}{5D4037}  % Dark brown for title

% --- Typography packages -----------------------------------------------------
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{enumitem}
\usepackage{float}
\usepackage{amssymb}

% --- Colored boxes (modern left-bar style) -----------------------------------
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}

% Report highlight box: light background + left accent bar.
% Usage: \begin{tcolorbox}[reportbox, title=Key Findings]
\tcbset{
  reportbox/.style={
    enhanced,
    colback=boxbg,
    colframe=boxbg,
    borderline west={3pt}{0pt}{accentbar},
    arc=0pt,
    boxrule=0pt,
    coltitle=boxtitle,
    colbacktitle=boxbg,
    fonttitle=\bfseries\large,
    toptitle=8pt,
    bottomtitle=6pt,
    breakable,
    top=8pt, bottom=10pt, left=12pt, right=12pt,
    before skip=1.2em,
    after skip=1.2em
  }
}

% Disclaimer box (amber/orange): flag caveats about data, AI, methodology.
% Usage: \begin{disclaimerbox}[Disclaimer]
\newtcolorbox{disclaimerbox}[1][]{
  enhanced,
  colback=disclaimerbg,
  colframe=disclaimerbg,
  borderline west={3pt}{0pt}{disclaimerbar},
  arc=0pt,
  boxrule=0.4pt,
  colbacktitle=disclaimerbg,
  coltitle=disclaimertitle,
  fonttitle=\bfseries\normalsize,
  toptitle=8pt,
  bottomtitle=6pt,
  breakable,
  top=8pt, bottom=10pt, left=12pt, right=12pt,
  before skip=1.2em,
  after skip=1.2em,
  title={#1},
}

% Document quote: left-bordered block for quoting source documents.
% Usage:
%   \begin{docquote}
%   \emph{``Quoted text.''}\\[2pt]
%   {\small -- Document Name (Year)} \hfill {\small \textcolor{midgray}{Label:} \textbf{Value}}
%   \end{docquote}
\newtcolorbox{docquote}{
  enhanced,
  colback=boxbg,
  colframe=boxbg,
  borderline west={2.5pt}{0pt}{accentbar!60},
  arc=0pt,
  boxrule=0pt,
  top=8pt, bottom=8pt, left=14pt, right=14pt,
  before skip=0.8em,
  after skip=0.8em,
}

% --- Headers and footers ----------------------------------------------------
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
% Customize the left header text per project:
\fancyhead[L]{\small\textcolor{midgray}{Report}}
\fancyhead[R]{\small\textcolor{midgray}{\thepage}}
\fancyfoot{}
\renewcommand{\headrulewidth}{0.3pt}
\renewcommand{\headrule}{{\color{lightgray}\hrule width\headwidth height\headrulewidth\vskip-\headrulewidth}}

% --- Title page styling ------------------------------------------------------
\usepackage{titling}

% Suppress Quarto's default \maketitle (we use a custom title page).
\renewcommand{\maketitle}{}

% --- Section formatting ------------------------------------------------------
\usepackage{titlesec}

\titleformat{\section}{\newpage\Large\bfseries}{\thesection}{1em}{}
\titlespacing*{\section}{0pt}{2em}{0.8em}

\titleformat{\subsection}{\large\bfseries}{\thesubsection}{1em}{}
\titlespacing*{\subsection}{0pt}{1.5em}{0.5em}

\titleformat{\subsubsection}{\normalsize\bfseries}{\thesubsubsection}{1em}{}

% --- Table & figure captions -------------------------------------------------
\usepackage{caption}
\captionsetup[table]{position=above, skip=8pt, font=small, labelfont=bf}
\captionsetup[figure]{font=small, labelfont=bf, skip=8pt}

% --- Smaller table fonts in longtable ----------------------------------------
\usepackage{etoolbox}
\AtBeginEnvironment{longtable}{\small}

% --- Tight lists -------------------------------------------------------------
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% --- Inline score bars (optional, for visual indicators) ---------------------
\usepackage{tikz}
\newcommand{\scorebar}[1]{%
  \begin{tikzpicture}[baseline=-0.3ex]
    \fill[boxbg] (0,0) rectangle (1.8cm,0.22cm);
    \fill[accentbar!70] (0,0) rectangle (#1*1.8cm,0.22cm);
    \node[anchor=west, font=\footnotesize, inner sep=0pt] at (1.9cm,0.11cm) {#1};
  \end{tikzpicture}%
}

% --- Verbatim input (for prompt/code appendices) -----------------------------
\usepackage{fancyvrb}
\usepackage{fvextra}
\usepackage{multicol}

% --- Figure paths ------------------------------------------------------------
% NOTE: \graphicspath is set per deliverable in the .qmd's header-includes,
% so that paths resolve correctly from each subfolder.
